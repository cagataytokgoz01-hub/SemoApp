<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Duygu Nerede?</title>

<style>
/* üåà GENEL */
html,body{
  margin:0; padding:0;
  width:100%; height:100%;
  overflow:hidden;
  overscroll-behavior:none;
  touch-action:manipulation;
  background:linear-gradient(#b7e2ff,#e9f7ff);
  font-family:system-ui, Arial, sans-serif;
}
*{box-sizing:border-box}
img{user-select:none;-webkit-user-drag:none}

/* ‚¨ú ORTA ALAN */
.app{
  width: calc(100% - 32px);
  max-width:960px;

  margin:16px auto;   /* üëà KRƒ∞Tƒ∞K: auto */
  height: calc(100svh - 32px);

  background:#ffffff;
  border-radius:24px;
  box-shadow:0 12px 30px rgba(0,0,0,.08);
  padding:16px;
  overflow:hidden;
}

.stage{
  width:100%;
  height:100%;
  position:relative;
}

/* üè† HOME */
#homeBtn{
  position:fixed;
  top:12px;
  left:12px;
  width:44px;
  height:44px;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10000;
}
#homeBtn img{
  width:28px;
  height:28px;
  pointer-events:none;
}

.body-img{
  display:block;

  /* üëá ORANTIYI KORUYAN SINIRLAR */
  max-width:60vw;        /* web i√ßin kritik */
  max-height:85vh;       /* ta≈ümayƒ± engeller */

  width:auto;
  height:auto;

  object-fit:contain;
}

.touch-spot{
  position:absolute;
  width:50px;
  height:50px;
  border-radius:50%;

  background: rgba(143, 211, 232, 0.25); /* #8FD3E8 %25 */

  pointer-events:none;   /* tƒ±klamayƒ± engellemez */
  transform: translate(-50%, -50%);
}

.stage{
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

.body-wrap{
  position:relative;
}

@media (max-width: 768px){
  .body-img{
    max-width:90vw;
    max-height:85vh;
  }
}

/* ‚ùå KAPAT BUTONU */
#closeBtn{
  position:absolute;
  right:16px;
  bottom:16px;

  width:44px;
  height:44px;
  padding:0;
  border:none;
  background:transparent;

  display:flex;
  align-items:center;
  justify-content:center;

  cursor:pointer;
  z-index:9999;
}

#closeBtn img{
  width:32px;
  height:32px;
  pointer-events:none;
}

#startOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.15);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20000;
  pointer-events:none;
}

.startBox{
  background:transparent;   /* ‚ùå beyaz yok */
  padding:0;                /* ‚ùå bo≈üluk yok */
  box-shadow:none;          /* ‚ùå g√∂lge yok */
}

#startBtn{
  width:160px;
  height:auto;
  cursor:pointer;
  user-select:none;
  pointer-events:auto;
}

</style>
</head>

<body>

<audio id="questionVoice" src="sounds/nerede.mp3" preload="auto"></audio>
<audio id="pauseVoice" src="sounds/burada_biraz_duralim.mp3" preload="auto"></audio>
<audio id="breathSound" src="sounds/nefes.mp3" preload="auto"></audio>

<!-- HOME -->
<a id="homeBtn" href="../app.html" aria-label="Ana Sayfa">
  <img src="images/geri.png" alt="Geri">
</a>

<div id="startOverlay">
  <div class="startBox">
    <img id="startBtn" src="images/ileri.png" alt="Ba≈üla">
  </div>
</div>

<div class="app">
  <div class="stage">
    <div class="body-wrap" id="bodyWrap">
      <img src="images/body.png" class="body-img" alt="Beden">
    </div>
  </div>

<!-- ‚ùå KAPAT BUTONU (BURAYA) -->
  <button id="closeBtn" aria-label="Kapat">
    <img src="images/kapat.png" alt="Kapat">
  </button>

</div>

<script>

  if (localStorage.getItem("licenseOK") === "true") {
  window.location.href = "app.html";
}

const questionVoice = document.getElementById("questionVoice");
const bodyWrap   = document.getElementById("bodyWrap");
const pauseVoice = document.getElementById("pauseVoice");
const breath     = document.getElementById("breathSound");

let timers = []; // t√ºm timeout‚Äôlarƒ± burada tutacaƒüƒ±z

let intervals = [];
let audios = [questionVoice, pauseVoice, breath];

function safeTimeout(fn, t){
  const id = setTimeout(fn, t);
  timers.push(id);
  return id;
}

function safeInterval(fn, t){
  const id = setInterval(fn, t);
  intervals.push(id);
  return id;
}

function stopAllAudio(){
  audios.forEach(a => {
    if(!a) return;
    a.pause();
    a.currentTime = 0;
  });
}

function clearAllTimers(){
  timers.forEach(clearTimeout);
  intervals.forEach(clearInterval);
  timers = [];
  intervals = [];
}

function clearAll(){
  clearAllTimers();
  stopAllAudio();

  // varsa se√ßili alan/efekt class‚Äôlarƒ± burada temizlenir
  document.querySelectorAll(".selected, .active, .playing").forEach(el=>{
    el.classList.remove("selected","active","playing");
  });
}

function startSequence(){
  clearAll(); // üî¥ √∂nce her ≈üeyi sƒ±fƒ±rla

  // 2 sn sonra "burada duralƒ±m"
  safeTimeout(() => pauseVoice.play(), 2000);
safeTimeout(() => breath.play(), 4000);
}

bodyWrap.addEventListener("pointerdown", (e) => {

  // üìç dokunma noktasƒ±
  const rect = bodyWrap.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  bodyWrap.querySelectorAll(".touch-spot").forEach(el => el.remove());

  const spot = document.createElement("div");
  spot.className = "touch-spot";
  spot.style.left = x + "px";
  spot.style.top  = y + "px";
  bodyWrap.appendChild(spot);

  // üîÅ HER DOKUNU≈û YENƒ∞ Rƒ∞T√úEL
  startSequence();
});

document.getElementById("closeBtn").addEventListener("click", () => {
  clearAll();          // sesleri ve timer‚Äôlarƒ± durdur
  location.reload();   // üîÑ tam reset
});

document.getElementById("startBtn").addEventListener("click", () => {
  document.getElementById("startOverlay").style.display = "none";
  questionVoice.play();
});

</script>

</body>

</html>
